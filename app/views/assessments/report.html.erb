<h2><%= "Assessment Report for #{@competency.name}" %></h2>

<br>
<%= link_to "Pick Another Assessment", assessments_path %>

<div id="levels-chart"></div>

<% @indicators_resources.each do |stage, indicators| %>
  <h3 class="secondary-color"><%= stage.capitalize %></h3>

  <% if indicators.empty? %>
    <p><em>There are no indicators for this stage at this time.</em></p>
  <% else %>
    <ul class="collapsible popout" data-collapsible="accordion">
      <% indicators.each do |indicator| %>
        <li>
          <div class="collapsible-header">
            <i class="material-icons tooltipped level-icon" data-level="<%= indicator.level.name %>" data-position="left" data-delay="50" data-tooltip="<%= indicator.level.name %>">assignment_turned_in</i>
            <%= indicator.description.html_safe %>
          </div>

          <div class="collapsible-body indicator">
            <ul class="collection with-header">
              <% indicator.resources.group_by(&:paradigm).each do |paradigm, resources| %>
                <li class="collection-header paradigm">
                  <h5><%= paradigm.name %></h5>
                </li>

                <% resources.each do |resource| %>
                  <li class="collection-item">
                    <div>
                      <%= resource.title.html_safe %>
                      <% if resource.link.present? %>
                        <a href="<%= resource.link %>" class="secondary-content">
                          <i class="material-icons">send</i>
                        </a>
                      <% end %>
                    </div>
                  </li>
                <% end %>
              <% end %>
            </ul>
          </div>
        </li>        
      <% end %>
    </ul>
  <% end %>
<% end %>

<script type="text/javascript">
  var indicators_resources = 
    <%= raw @indicators_resources.to_json(
          include: [
            :level, 
            {
              :resources => {
                include: :paradigm
              }
            }
          ], 
          except: [:created_at, :updated_at]
    ) %>;
  var levels = <%= raw @levels.to_json %>;
  var competency = <%= raw @competency.to_json %>;
  initColors(levels);
  createLevelsChart(indicators_resources, levels, competency);
  setLevelColor();
</script>

<%= render "hover_menu" %>
